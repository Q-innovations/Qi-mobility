<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--Bootstrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
        </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
        </script>

    <title>イベント予約</title>
    <script>
        function OnPost() {

            const URL = "GASのデプロイURL";

            let SendDATA = {
                "column_1": document.getElementById("eplace").value,
                "column_2": document.getElementById("riyokana").value,
                "column_3": document.getElementById("starttime").value,
                "column_4": document.getElementById("menu").value
            };
            let postparam = {
                "method": "POST",
                "mode": "no-cors",
                "Content-Type": "application/x-www-form-urlencoded",
                "body": JSON.stringify(SendDATA)
            };
            fetch(URL, postparam);
        }
        function OnGet() {

            const URL = "https://script.google.com/macros/s/AKfycbyrYFlLIBxGs4mWX_JpycAIQlaIRdgUu0Wdv-hgCWs7/dev";

            fetch(URL)
                .then(response => {
                    return response.json();
                })
                .then(data => {
                    render_text = data.message;
                    document.getElementById("get_value").innerHTML = render_text;
                })
                .catch(error => {
                    document.getElementById("get_value").innerHTML = error;
                });
        }
    </script>
</head>

<body>
    <div class="container">
        <form action="#" method="POST">
            <div class="form-group">
                <label for="title">≪予約情報照会≫</label>
            </div>
            <div class="form-group">
                <label for="place">会場</label>
                <select class="form-select form-select-lg mb-3" aria-label="会場">
                    <option value="1">2022年06月26日(日)リバーサイド東櫛原</option>
                    <option value="2">2022年10月XX日(土)＋ｙｏｕ</option>
                </select>
            </div>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">開始時刻</th>
                        <th scope="col">予約状況</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td><label for="title">13：00</label></td>
                        <td><label for="title">残りわずか</label></td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td><label for="title">13：30</label></td>
                        <td><label for="title">予約可</label></td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td><label for="title">14：00</label></td>
                        <td><label for="title">予約不可</label></td>
                    </tr>
                    <tr>
                        <th scope="row">4</th>
                        <td><label for="title">14：30</label></td>
                        <td><label for="title">残りわずか</label></td>
                    </tr>
                    <tr>
                        <th scope="row">5</th>
                        <td><label for="title">15：00</label></td>
                        <td><label for="title">予約可</label></td>
                    </tr>
                    <tr>
                        <th scope="row">6</th>
                        <td><label for="title">15：30</label></td>
                        <td><label for="title">予約不可</label></td>
                    </tr>
                    <tr>
                        <th scope="row">7</th>
                        <td><label for="title">16：00</label></td>
                        <td><label for="title">予約可</label></td>
                    </tr>
                    <tr>
                        <th scope="row">8</th>
                        <td><label for="title">16：30</label></td>
                        <td><label for="title">残りわずか</label></td>
                    </tr>
                </tbody>
            </table>
            <div class="form-group">
                <label for="title">≪予約会場、利用者、開始時刻を入力ください≫</label>
            </div>
            <input type="hidden" id="useridprofilefield" name="useridprofilefield" value="userId" />
            <input type="hidden" id="displaynamefield" name="displaynamefield" value="displaynamefield" />
            <div class="form-group">
                <label for="eplace">会場</label>
                <select class="form-select form-select-lg mb-3" aria-label="会場" id="eplace">
                    <option value="1">2022年06月26日(日)リバーサイド東櫛原</option>
                    <option value="2">2022年10月XX日(土)＋ｙｏｕ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="riyokana">利用者かな</label>
                <select class="form-select form-select-lg mb-3" aria-label="利用者かな" id="riyokana">
                    <option value="1">もび　たろう</option>
                    <option value="2">もび　はなこ</option>
                </select>
            </div>
            <div class="form-group">
                <label for="starttime">開始時刻</label>
                <select class="form-select form-select-lg mb-3" aria-label="開始時刻" id="starttime">
                    <option value="1300">13：00</option>
                    <option value="1330">13：30</option>
                    <option value="1400">14：00</option>
                    <option value="1430">14：30</option>
                    <option value="1500">15：00</option>
                    <option value="1530">15：30</option>
                    <option value="1600">16：00</option>
                    <option value="1630">16：30</option>
                </select>
            </div>
            <div class="form-group">
                <label for="menu">機種</label>
                <select class="form-select form-select-lg mb-3" aria-label="機種" id="menu">
                    <option value="1">Segway(手)</option>
                    <option value="2">Segway(足)</option>
                    <option value="3">Kintone(オフロード)</option>
                </select>
            </div>
            <div class="form-group">
<!--                 <input type="submit" id="submit-btn" value="登録" class="btn btn-primary"> -->
                <input type="button" id="submit-btn" value="登録" onclick="OnPost();" class="btn btn-primary">
            </div>
        </form>
    </div>
</body>
<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
    // ロード時処理 
    window.addEventListener('load', function () {
        // LINE DevelopersのliffId★各自変更
        var liffId = "1657149830-k11N9eMA";
        // liff処理 
        liff.init({
            liffId: liffId
        }).then(() => {
            // LINEプロフィール取得表示
            getLineProfile();
            // GasUserinfo取得
            getGasUserinfo();
            // GasUserinfoがあれば続行、なければ利用者登録アラート

            // GasEventinfo会場取得
            // getGasEventinfo();           
            // GasEventmenu機器取得
            // getGasEventmenu();           
            // GasEventReserveView予約残数取得
            // getGasEventReserveView();
            // GasEventReserveViewセット
            // dispGasEventReserveView();
            // GasEventinfo会場セット
            // dispGasEventinfo();
            // GasUserinfo利用者セット
            // dispGasUserinfo();
            // GasEventmenu機器セット
            // dispGasEventmenu();
        });
    })

    // LINEプロフィール取得
    function getLineProfile() {
        //初期化 
        // https://developers.line.me/ja/reference/liff/#liffgetprofile()
        liff.getProfile().then(function (profile) {
            // profile情報セット
            document.getElementById('useridprofilefield').value = profile.userId;
            document.getElementById('displaynamefield').value = profile.displayName;
            // アラート出力
            var nowDate = new Date();
            var userId = profile.userId;
            var displayName = profile.displayName;
            var getLanguage = liff.getLanguage();
            var isInClient = liff.isInClient();
            var isLoggedIn = liff.isLoggedIn();
            window.alert(nowDate + " " + userId + " " + displayName + " " + getLanguage + " " + isInClient + " " + isLoggedIn);
        }).catch(function (error) {
            window.alert("LINEから起動してください");
        });
    }

    /*
        // GasUserinfo取得
        function getGasUserinfo() {
            // GASでデプロイしたWebアプリケーションのURL
            // https://ryjkmr.com/gas-web-application-usual-way/
            const ENDPOINT = "★WebAPIのURL★";
            const data = userId;
    
            $.ajax({
                type: "POST",
                url: END_POINT,
                dataType: "json",
                data: { action: 'getGasUserinfo', data: JSON.stringify(data) }
            })
                .then(
                    (result) => { // 成功した時の処理
                        console.log(JSON.stringify(result));
                    },
                    (error) => { // 失敗した時の処理
                        alert('Error:' + JSON.stringify(error));
                    }
                );
        }
    
        // GasUserinfoがあれば続行、なければ利用者登録アラート
    
        // GasEventinfo会場取得
        // getGasEventinfo();           
        // GasEventmenu機器取得
        // getGasEventmenu();           
        // GasEventReserveView予約残数取得
        // getGasEventReserveView();
        // GasEventReserveViewセット
        // dispGasEventReserveView();
        // GasEventinfo会場セット
        // dispGasEventinfo();
        // GasUserinfo利用者セット
        // dispGasUserinfo();
        // GasEventmenu機器セット
        // dispGasEventmenu();
    */

    // 登録ボタン処理
    $('form').submit(function () {

        // EventReserveにデータがあれば注意を促す
        // GAS＋googleスプレッドシート登録
        //        insertEventReserve();
        // PAYPAYAPI連携
        // PAYPAYIDと詳細と金額を送信して支払い
        //        paymentPaypay();

        // sendMessages call
        if (!liff.isInClient()) {
            window.alert('LINEから起動してください');
        } else {
            liff.sendMessages([
                {
                    type: 'text',
                    text: JSON.stringify('イベント予約登録完了！' + document.getElementById('useridprofilefield').value),
                },
            ])
                .then(() => {
                    //window.alert('Message sent');
                    liff.closeWindow();
                })
                .catch((error) => {
                    window.alert('Error sending message: ' + error);
                });
        }
        return false;
    });

</script>

</html>